<?php

/**
 * Class Database
 */
class Database extends MY_Controller {

	/**
	 * Database constructor.
	 */
	function __construct() {
		parent::__construct();
		$this->load->model('Update_model', 'updater');
	}


	/**
	 *
	 */
	function run_updates() {
		$messages = [];
		foreach (get_class_methods('Database') as $method) {
			if ($my_method = strstr($method, 'db_update_')) {
				$id = (int) filter_var($my_method, FILTER_SANITIZE_NUMBER_INT);
				$query = $this->$my_method();
				if ($message = $this->updater->update($id, $query)) {
					$messages[] = $message;
				}
			}
		}
		$this->session->set_flashdata('notice', implode('<br/>', $messages));
		redirect();
	}

	/**
	 * @return string
	 */
	function db_update_1(): string {
		return 'ALTER TABLE `orders` CHANGE `count_midsale` `count_midsale` DECIMAL(10,2) NULL DEFAULT NULL;';
	}

	/**
	 * @return string
	 */
	function db_update_2(): string {
		return 'ALTER TABLE `orders` CHANGE `count_presale` `count_presale` DECIMAL(10,2) NULL DEFAULT NULL;';

	}

	/**
	 * @return string
	 */
	function db_update_3(): string {
		return 'ALTER TABLE `orders` CHANGE `received_midsale` `received_midsale` DECIMAL(10,2) NULL DEFAULT NULL;';

	}

	/**
	 * @return string
	 */
	function db_update_4(): string {
		return 'ALTER TABLE `orders` CHANGE `received_presale` `received_presale` DECIMAL(10,2) NULL DEFAULT NULL;';
	}

	/**
	 * @return string
	 */
	function db_update_5(): string {
		return 'ALTER TABLE `orders` CHANGE `received_presale` `received_presale` DECIMAL(10,2) NULL DEFAULT NULL;';
	}

	/**
	 * @return string
	 */
	function db_update_6(): string {
		return 'ALTER TABLE `orders` CHANGE `received_presale` `received_presale` DECIMAL(10,2) NULL DEFAULT NULL;';
	}

	/**
	 * @return string
	 */
	function db_update_7(): string {
		return 'ALTER TABLE `orders` CHANGE `count_dead` `count_dead` DECIMAL(10,2) NULL DEFAULT NULL;';
	}

	/**
	 * @return string
	 */
	function db_update_8(): string {
		return 'UPDATE `variety` set new_year = 2021 where new_year = 2020;';
	}


	/**
	 * @return string
	 */
	function db_update_10(): string {
		return 'ALTER TABLE `orders` ADD IF NOT EXISTS `count_friday` DECIMAL(10,2) NULL;';
	}

	/**
	 * @return string
	 */
	function db_update_11(): string {
		return 'ALTER TABLE `orders` ADD IF NOT EXISTS `count_saturday` DECIMAL(10,2) NULL;';

	}


	/**
	 * @return string
	 */
	function db_update_13(): string {
		return 'ALTER TABLE `orders` ADD IF NOT EXISTS `received_friday` DECIMAL(10,2) NULL;';
	}

	/**
	 * @return string
	 */
	function db_update_14(): string {
		return 'ALTER TABLE `orders` ADD IF NOT EXISTS `received_saturday` DECIMAL(10,2) NULL;';
	}

	/**
	 * @return string
	 */
	function db_update_15(): string {
		return 'ALTER TABLE `orders` ADD IF NOT EXISTS `flat_exclude` BOOLEAN NOT NULL DEFAULT FALSE';
	}

	/**
	 * @return string
	 */
	/*	function db_update_16(): string {
			return 'ALTER TABLE `users_groups` DROP INDEX IF EXISTS `fk_users_groups_users1_idx`;';

		}*/


	/**
	 * @return string
	 */
	/*function db_update_17(): string {
		return 'ALTER TABLE `users_groups` DROP INDEX IF EXISTS `fk_users_groups_groups1_idx`;';

	}*/

	/**
	 * @return string
	 */
	/*function db_update_18(): string {
		return 'ALTER TABLE `users_groups` DROP INDEX IF EXISTS `uc_users_groups`;';
	}*/

	/**
	 * @return string
	 */
	function db_update_19(): string {
		return 'ALTER TABLE `orders` DROP IF EXISTS `count_thursday`;';
	}


	/**
	 * @return string
	 */
	function db_update_20(): string {
		return 'ALTER TABLE `orders` DROP IF EXISTS `received_thursday`';
	}

	/**
	 * add online_only field to the variety table for consumption by the live site
	 *
	 * @return string
	 */
	function db_update_21(): string {
		return 'ALTER TABLE `variety`  ADD `online_only` ENUM("yes","no") NOT NULL DEFAULT "no";';
	}

	/**
	 * remove online_only field from the variety table as it is redundant
	 */
	function db_update_22(): string {
		return 'ALTER TABLE `variety` DROP IF EXISTS `online_only`;';
	}

	function fix_orders() {
		$rows = [
			33283 => '2.00',
			33888 => '3.00',
			33892 => '1.00',
			33895 => '1.00',
			33896 => '1.00',
			33902 => '1.00',
			33907 => '1.00',
			33911 => '2.00',
			33916 => '1.00',
			33918 => '1.00',
			33927 => '1.00',
			33951 => '9.00',
			33952 => '10.00',
			33956 => '1.00',
			33961 => '2.00',
			33967 => '7.00',
			33968 => '5.00',
			33972 => '3.00',
			33975 => '1.00',
			33976 => '2.00',
			33977 => '5.00',
			33978 => '2.00',
			33983 => '3.00',
			33997 => '5.00',
			33998 => '3.00',
			34000 => '3.00',
			34001 => '3.00',
			34002 => '5.00',
			34009 => '2.00',
			34010 => '2.00',
			34011 => '2.00',
			34012 => '2.00',
			34013 => '2.00',
			34016 => '3.00',
			34017 => '5.00',
			34021 => '3.00',
			34024 => '2.00',
			34025 => '3.00',
			34035 => '4.00',
			34037 => '2.00',
			34038 => '4.00',
			34049 => '4.00',
			34050 => '6.00',
			34062 => '3.00',
			34072 => '7.00',
			34075 => '12.00',
			34082 => '2.00',
			34085 => '3.00',
			34086 => '4.00',
			34087 => '4.00',
			34088 => '5.00',
			34089 => '4.00',
			34090 => '2.00',
			34091 => '5.00',
			34092 => '3.00',
			34093 => '4.00',
			34094 => '3.00',
			34096 => '3.00',
			34102 => '3.00',
			34103 => '3.00',
			34104 => '3.00',
			34107 => '6.00',
			34108 => '3.00',
			34121 => '4.00',
			34127 => '4.00',
			34129 => '2.00',
			34130 => '2.00',
			34131 => '2.00',
			34132 => '2.00',
			34136 => '3.00',
			34138 => '2.00',
			34140 => '2.00',
			34141 => '2.00',
			34143 => '2.00',
			34148 => '3.00',
			34150 => '2.00',
			34153 => '4.00',
			34154 => '5.00',
			34155 => '4.00',
			34156 => '5.00',
			34168 => '4.00',
			34170 => '4.00',
			34171 => '5.00',
			34173 => '2.00',
			34174 => '5.00',
			34176 => '3.00',
			34184 => '1.00',
			34186 => '2.00',
			34188 => '3.00',
			34190 => '2.00',
			34199 => '2.00',
			34200 => '2.00',
			34201 => '2.00',
			34203 => '1.00',
			34204 => '1.00',
			34205 => '1.00',
			34207 => '2.00',
			34210 => '2.00',
			34212 => '2.00',
			34214 => '4.00',
			34216 => '2.00',
			34217 => '2.00',
			34222 => '2.00',
			34223 => '2.00',
			34225 => '2.00',
			34230 => '2.00',
			34231 => '2.00',
			34232 => '1.00',
			34233 => '1.00',
			34236 => '1.00',
			34237 => '2.00',
			34238 => '3.00',
			34239 => '7.00',
			34241 => '1.00',
			34245 => '3.00',
			34246 => '3.00',
			34247 => '2.00',
			34250 => '1.00',
			34251 => '2.00',
			34252 => '1.00',
			34253 => '1.00',
			34258 => '4.00',
			34260 => '4.00',
			34266 => '3.00',
			34267 => '3.00',
			34269 => '3.00',
			34270 => '3.00',
			34271 => '3.00',
			34272 => '4.00',
			34273 => '5.00',
			34274 => '3.00',
			34282 => '3.00',
			34283 => '4.00',
			34285 => '4.00',
			34293 => '3.00',
			34297 => '3.00',
			34298 => '1.00',
			34300 => '2.00',
			34301 => '2.00',
			34302 => '2.00',
			34303 => '2.00',
			34304 => '3.00',
			34308 => '1.00',
			34312 => '1.00',
			34314 => '1.00',
			34316 => '2.00',
			34318 => '1.00',
			34319 => '2.00',
			34320 => '2.00',
			34324 => '1.00',
			34327 => '3.00',
			34331 => '3.00',
			34332 => '2.00',
			34334 => '3.00',
			34335 => '3.00',
			34336 => '2.00',
			34337 => '3.00',
			34338 => '3.00',
			34339 => '2.00',
			34340 => '3.00',
			34341 => '3.00',
			34342 => '2.00',
			34343 => '3.00',
			34344 => '3.00',
			34345 => '2.00',
			34346 => '3.00',
			34347 => '1.00',
			34353 => '3.00',
			34354 => '3.00',
			34355 => '6.00',
			34356 => '2.00',
			34357 => '2.00',
			34361 => '2.00',
			34362 => '2.00',
			34363 => '3.00',
			34364 => '5.00',
			34365 => '1.00',
			34369 => '2.00',
			34371 => '3.00',
			34373 => '2.00',
			34374 => '3.00',
			34375 => '3.00',
			34377 => '5.00',
			34378 => '3.00',
			34379 => '1.00',
			34382 => '4.00',
			34383 => '5.00',
			34384 => '1.00',
			34385 => '2.00',
			34386 => '2.00',
			34388 => '1.00',
			34390 => '3.00',
			34391 => '2.00',
			34392 => '2.00',
			34393 => '2.00',
			34394 => '2.00',
			34396 => '3.00',
			34397 => '2.00',
			34398 => '2.00',
			34399 => '1.00',
			34400 => '1.00',
			34403 => '5.00',
			34404 => '2.00',
			34406 => '2.00',
			34407 => '1.00',
			34410 => '4.00',
			34412 => '3.00',
			34413 => '2.00',
			34415 => '2.00',
			34416 => '7.00',
			34421 => '1.00',
			34422 => '4.00',
			34423 => '2.00',
			34424 => '2.00',
			34425 => '3.00',
			34429 => '2.00',
			34433 => '3.00',
			34434 => '2.00',
			34436 => '3.00',
			34437 => '3.00',
			34438 => '1.00',
			34439 => '3.00',
			34441 => '2.00',
			34444 => '2.00',
			34445 => '3.00',
			34450 => '2.00',
			34451 => '2.00',
			34452 => '2.00',
			34453 => '1.00',
			34455 => '2.00',
			34458 => '1.00',
			34459 => '2.00',
			34460 => '2.00',
			34461 => '2.00',
			34462 => '2.00',
			34463 => '1.00',
			34465 => '2.00',
			34466 => '2.00',
			34469 => '2.00',
			34474 => '3.00',
			34475 => '2.00',
			34477 => '2.00',
			34479 => '1.00',
			34480 => '2.00',
			34483 => '2.00',
			34485 => '1.00',
			34486 => '2.00',
			34487 => '2.00',
			34491 => '2.00',
			34492 => '2.00',
			34493 => '2.00',
			34494 => '1.00',
			34504 => '2.00',
			34505 => '2.00',
			34514 => '2.00',
			34515 => '2.00',
			34517 => '2.00',
			34518 => '1.00',
			34522 => '1.00',
			34523 => '1.00',
			34524 => '1.00',
			34526 => '3.00',
			34529 => '2.00',
			34530 => '2.00',
			34531 => '1.00',
			34534 => '1.00',
			34537 => '1.00',
			34538 => '1.00',
			34539 => '1.00',
			34540 => '1.00',
			34541 => '1.00',
			34542 => '1.00',
			34543 => '2.00',
			34544 => '1.00',
			34545 => '1.00',
			34546 => '1.00',
			34547 => '1.00',
			34548 => '1.00',
			34551 => '1.00',
			34552 => '4.00',
			34553 => '1.00',
			34554 => '1.00',
			34555 => '4.00',
			34556 => '4.00',
			34557 => '4.00',
			34567 => '2.00',
			34568 => '1.00',
			34570 => '1.00',
			34571 => '2.00',
			34572 => '1.00',
			34573 => '2.00',
			34574 => '1.00',
			34576 => '1.00',
			34577 => '2.00',
			34594 => '1.00',
			34595 => '2.00',
			34600 => '1.00',
			34601 => '2.00',
			34602 => '2.00',
			34604 => '2.00',
			34607 => '2.00',
			34608 => '1.00',
			34609 => '2.00',
			34611 => '2.00',
			34614 => '2.00',
			34615 => '1.00',
			34617 => '5.00',
			34618 => '4.00',
			34620 => '2.00',
			34622 => '2.00',
			34623 => '3.00',
			34624 => '1.00',
			34626 => '2.00',
			34629 => '2.00',
			34630 => '3.00',
			34635 => '3.00',
			34637 => '2.00',
			34639 => '3.00',
			34642 => '2.00',
			34655 => '25.00',
			34670 => '1.00',
			34672 => '2.00',
			34696 => '3.00',
			34697 => '1.00',
			34700 => '5.00',
			34703 => '4.00',
			34704 => '9.00',
			34707 => '3.00',
			34708 => '45.00',
			34709 => '5.00',
			34711 => '4.00',
			34712 => '4.00',
			34713 => '4.00',
			34714 => '3.00',
			34716 => '1.00',
			34718 => '6.00',
			34719 => '8.00',
			34720 => '2.00',
			34726 => '2.00',
			34728 => '2.00',
			34738 => '6.00',
			34740 => '5.00',
			34741 => '8.00',
			34742 => '8.00',
			34743 => '3.00',
			34744 => '2.00',
			34748 => '5.00',
			34757 => '11.00',
			34758 => '11.00',
			34763 => '20.00',
			34766 => '5.00',
			34767 => '9.00',
			34768 => '5.00',
			34773 => '5.00',
			34774 => '4.00',
			34777 => '1.00',
			34778 => '2.00',
			34782 => '3.00',
			34783 => '6.00',
			34785 => '13.00',
			34789 => '3.00',
			34809 => '9.00',
			34811 => '2.00',
			34812 => '5.00',
			34813 => '6.00',
			34814 => '3.00',
			34815 => '5.00',
			34816 => '5.00',
			34817 => '6.00',
			34819 => '5.00',
			34820 => '3.00',
			34821 => '1.00',
			34822 => '3.00',
			34823 => '2.00',
			34824 => '3.00',
			34825 => '4.00',
			34827 => '4.00',
			34828 => '3.00',
			34829 => '6.00',
			34831 => '3.00',
			34832 => '8.00',
			34833 => '4.00',
			34834 => '6.00',
			34835 => '3.00',
			34836 => '3.00',
			34837 => '2.00',
			34838 => '2.00',
			34839 => '2.00',
			34841 => '8.00',
			34843 => '6.00',
			34847 => '3.00',
			34848 => '2.00',
			34850 => '5.00',
			34851 => '6.00',
			34852 => '4.00',
			34855 => '6.00',
			34856 => '3.00',
			34859 => '10.00',
			34861 => '1.00',
			34863 => '3.00',
			34864 => '3.00',
			34867 => '6.00',
			34868 => '3.00',
			34869 => '2.00',
			34870 => '2.00',
			34871 => '3.00',
			34873 => '2.00',
			34875 => '3.00',
			34876 => '3.00',
			34877 => '1.00',
			34878 => '3.00',
			34879 => '5.00',
			34880 => '3.00',
			34882 => '1.00',
			34883 => '3.00',
			34884 => '2.00',
			34885 => '3.00',
			34886 => '3.00',
			34888 => '3.00',
			34889 => '3.00',
			34891 => '19.00',
			34892 => '3.00',
			34893 => '4.00',
			34894 => '13.00',
			34897 => '3.00',
			34898 => '3.00',
			34899 => '5.00',
			34900 => '5.00',
			34903 => '4.00',
			34905 => '6.00',
			34906 => '2.00',
			34907 => '3.00',
			34908 => '4.00',
			34909 => '5.00',
			34910 => '4.00',
			34911 => '4.00',
			34912 => '5.00',
			34913 => '5.00',
			34916 => '19.00',
			34917 => '3.00',
			34918 => '3.00',
			34919 => '2.00',
			34920 => '3.00',
			34921 => '4.00',
			34922 => '3.00',
			34923 => '3.00',
			34927 => '3.00',
			34928 => '4.00',
			34929 => '6.00',
			34930 => '5.00',
			34931 => '2.00',
			34932 => '4.00',
			34933 => '23.00',
			34934 => '8.00',
			34935 => '5.00',
			34936 => '6.00',
			34937 => '5.00',
			34938 => '7.00',
			34939 => '5.00',
			34940 => '5.00',
			34941 => '4.00',
			34942 => '5.00',
			34943 => '3.00',
			34944 => '4.00',
			34945 => '3.00',
			34946 => '3.00',
			34947 => '9.00',
			34948 => '3.00',
			34949 => '3.00',
			34950 => '6.00',
			34951 => '10.00',
			34952 => '7.00',
			34953 => '5.00',
			34954 => '6.00',
			34955 => '8.00',
			34956 => '3.00',
			34957 => '11.00',
			34958 => '4.00',
			34959 => '4.00',
			34960 => '2.00',
			34961 => '3.00',
			34962 => '3.00',
			34964 => '3.00',
			34965 => '3.00',
			34971 => '3.00',
			34972 => '9.00',
			34973 => '5.00',
			34975 => '4.00',
			34977 => '3.00',
			34978 => '4.00',
			34979 => '5.00',
			34980 => '2.00',
			34982 => '5.00',
			35027 => '15.00',
			35029 => '27.00',
			35035 => '4.00',
			35038 => '2.00',
			35039 => '8.00',
			35040 => '4.00',
			35042 => '2.00',
			35043 => '4.00',
			35044 => '3.00',
			35049 => '1.00',
			35050 => '2.00',
			35051 => '1.00',
			35063 => '2.00',
			35064 => '1.00',
			35110 => '4.00',
			35111 => '5.00',
			35112 => '5.00',
			35116 => '4.00',
			35117 => '3.00',
			35118 => '4.00',
			35119 => '3.00',
			35120 => '3.00',
			35121 => '3.00',
			35122 => '3.00',
			35123 => '1.00',
			35124 => '3.00',
			35125 => '3.00',
			35126 => '3.00',
			35186 => '1.00',
			35187 => '1.00',
			35192 => '3.00',
			35194 => '1.00',
			35197 => '5.00',
			35198 => '3.00',
			35199 => '2.00',
			35205 => '1.00',
			35206 => '1.00',
			35208 => '3.00',
			35209 => '1.00',
			35433 => '5.00',
			35434 => '1.00',
			35435 => '2.00',
			35436 => '3.00',
			35437 => '9.00',
			35438 => '2.00',
			35439 => '5.00',
			35440 => '3.00',
			35441 => '3.00',
			35442 => '3.00',
			35443 => '6.00',
			35444 => '3.00',
			35445 => '5.00',
			35446 => '2.00',
			35447 => '6.00',
			35448 => '1.00',
			35449 => '2.00',
			35450 => '2.00',
			35451 => '2.00',
			35452 => '2.00',
			35453 => '2.00',
			35454 => '3.00',
			35455 => '3.00',
			35456 => '3.00',
			35458 => '3.00',
			35459 => '3.00',
			35460 => '3.00',
			35461 => '5.00',
			35462 => '4.00',
			35463 => '3.00',
			35464 => '3.00',
			35465 => '3.00',
			35466 => '3.00',
			35481 => '3.00',
			35482 => '1.00',
			35504 => '4.00',
			35528 => '1.00',
			35529 => '2.00',
			35533 => '2.00',
			35540 => '10.00',
			35541 => '2.00',
			35542 => '1.00',
			35543 => '2.00',
			35544 => '1.00',
			35545 => '2.00',
			35546 => '1.00',
			35547 => '2.00',
			35572 => '9.00',
			35581 => '4.00',
			35582 => '4.00',
			35588 => '2.00',
			35590 => '2.00',
			35591 => '2.00',
			35592 => '2.00',
			35593 => '5.00',
			35594 => '2.00',
		];
		$this->load->model('order_model');
		foreach($rows as $id=>$count){
				$this->order_model->update($id, ['count_friday'=>$count]);
		}
	}


}
